<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniFFI UDL Guide - Rust Multiplatform Template</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3, h4 { color: #004e89; }
        h1 { border-bottom: 3px solid #ff6b35; padding-bottom: 10px; }
        h2 { border-bottom: 2px solid #1a659e; padding-bottom: 8px; margin-top: 30px; }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #1a659e;
            overflow-x: auto;
        }
        pre code {
            background: none;
            padding: 0;
        }
        a { color: #1a659e; text-decoration: none; }
        a:hover { color: #ff6b35; text-decoration: underline; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background: #004e89;
            color: white;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        blockquote {
            border-left: 4px solid #ff6b35;
            padding-left: 20px;
            margin-left: 0;
            color: #666;
            font-style: italic;
        }
        .nav {
            background: #004e89;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        .nav a {
            color: white;
            margin-right: 20px;
            font-weight: 500;
        }
        .nav a:hover { color: #ff6b35; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="index.html">üè† Home</a>
        <a href="README.html">üìã README</a>
        <a href="DEVELOPMENT.html">üîß Development</a>
        <a href="UDL_GUIDE.html">üéØ UDL Guide</a>
        <a href="SWIFT_EXAMPLES.html">üçé Swift Examples</a>
        <a href="KOTLIN_EXAMPLES.html">ü§ñ Kotlin Examples</a>
        <a href="lib/index.html">üìñ API Docs</a>
    </div>
    <div class="container">
        <h1 id="uniffi-udl-guide">UniFFI UDL Guide</h1>
<p>This guide explains how to use and modify the UniFFI Interface Definition Language (UDL) file in this project.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#what-is-udl">What is UDL?</a></li>
<li><a href="#why-use-udl">Why Use UDL?</a></li>
<li><a href="#udl-file-location">UDL File Location</a></li>
<li><a href="#basic-syntax">Basic Syntax</a></li>
<li><a href="#adding-new-functions">Adding New Functions</a></li>
<li><a href="#working-with-types">Working with Types</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#async-functions">Async Functions</a></li>
<li><a href="#objects-and-interfaces">Objects and Interfaces</a></li>
<li><a href="#complete-example">Complete Example</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<hr />
<h2 id="what-is-udl">What is UDL?</h2>
<p>UDL (Uniform Definition Language) is UniFFI's interface definition language. It's a declarative way to define your Rust API that will be exposed to Swift and Kotlin.</p>
<p>Instead of using Rust attributes like <code>#[uniffi::export]</code>, you write a <code>.udl</code> file that describes your API, and UniFFI generates all the binding code automatically.</p>
<hr />
<h2 id="why-use-udl">Why Use UDL?</h2>
<p><strong>Advantages of UDL:</strong></p>
<ol>
<li><strong>Clear API Contract</strong>: The UDL file serves as a clear, language-agnostic contract</li>
<li><strong>Better Documentation</strong>: Easier to understand the public API at a glance</li>
<li><strong>Type Safety</strong>: Explicit type definitions catch errors early</li>
<li><strong>Separation of Concerns</strong>: Keep binding definitions separate from implementation</li>
<li><strong>Team Collaboration</strong>: Non-Rust developers can understand the API</li>
</ol>
<p><strong>When to use UDL vs Proc Macros:</strong></p>
<ul>
<li><strong>Use UDL</strong> for:</li>
<li>Complex APIs with many types</li>
<li>Team projects where API clarity is important</li>
<li>
<p>When you want a single source of truth for the API</p>
</li>
<li>
<p><strong>Use Proc Macros</strong> (<code>#[uniffi::export]</code>) for:</p>
</li>
<li>Simple, small libraries</li>
<li>Rapid prototyping</li>
<li>When you prefer keeping everything in Rust</li>
</ul>
<hr />
<h2 id="udl-file-location">UDL File Location</h2>
<p>In this project, the UDL file is located at:</p>
<div class="codehilite"><pre><span></span><code>src/template.udl
</code></pre></div>

<p>The build system (<code>build.rs</code>) reads this file and generates the necessary scaffolding code.</p>
<hr />
<h2 id="basic-syntax">Basic Syntax</h2>
<h3 id="namespace">Namespace</h3>
<p>Every UDL file must have a namespace that defines top-level functions:</p>
<div class="codehilite"><pre><span></span><code>namespace template {

    string echo(string input);
}
</code></pre></div>

<p>This generates:
- <strong>Swift</strong>: <code>random()</code> and <code>echo(input:)</code>
- <strong>Kotlin</strong>: <code>random()</code> and <code>echo(input)</code></p>
<h3 id="comments">Comments</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Single-line comment</span>

<span class="c1">// Multi-line example:</span>
<span class="c1">// This function does something</span>
<span class="c1">// important</span>
<span class="n">boolean</span><span class="w"> </span><span class="n">my_function</span><span class="p">();</span>
</code></pre></div>

<hr />
<h2 id="adding-new-functions">Adding New Functions</h2>
<h3 id="step-1-define-in-udl">Step 1: Define in UDL</h3>
<p>Add your function to the namespace block in <code>src/template.udl</code>:</p>
<div class="codehilite"><pre><span></span><code>namespace template {
    // Existing functions...

    // Your new function
    u32 calculate_sum(u32 a, u32 b);
}
</code></pre></div>

<h3 id="step-2-implement-in-rust">Step 2: Implement in Rust</h3>
<p>Add the implementation in <code>src/template.rs</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="sd">/// Calculate the sum of two numbers</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">calculate_sum</span><span class="p">(</span><span class="n">a</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="step-3-export-in-librs">Step 3: Export in lib.rs</h3>
<p>Add to the public API in <code>src/lib.rs</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">template</span>::<span class="n">calculate_sum</span><span class="p">;</span>
</code></pre></div>

<h3 id="step-4-rebuild">Step 4: Rebuild</h3>
<div class="codehilite"><pre><span></span><code>cargo<span class="w"> </span>build<span class="w"> </span>--lib
./scripts/build-apple.sh<span class="w">    </span><span class="c1"># For iOS/macOS</span>
./scripts/build-kotlin.sh<span class="w">   </span><span class="c1"># For Android/JVM</span>
</code></pre></div>

<hr />
<h2 id="working-with-types">Working with Types</h2>
<h3 id="primitive-types">Primitive Types</h3>
<table>
<thead>
<tr>
<th>UDL Type</th>
<th>Rust Type</th>
<th>Swift Type</th>
<th>Kotlin Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>boolean</code></td>
<td><code>bool</code></td>
<td><code>Bool</code></td>
<td><code>Boolean</code></td>
</tr>
<tr>
<td><code>string</code></td>
<td><code>String</code></td>
<td><code>String</code></td>
<td><code>String</code></td>
</tr>
<tr>
<td><code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code></td>
<td><code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code></td>
<td><code>UInt8</code>, <code>UInt16</code>, <code>UInt32</code>, <code>UInt64</code></td>
<td><code>UByte</code>, <code>UShort</code>, <code>UInt</code>, <code>ULong</code></td>
</tr>
<tr>
<td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code></td>
<td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code></td>
<td><code>Int8</code>, <code>Int16</code>, <code>Int32</code>, <code>Int64</code></td>
<td><code>Byte</code>, <code>Short</code>, <code>Int</code>, <code>Long</code></td>
</tr>
<tr>
<td><code>f32</code>, <code>f64</code></td>
<td><code>f32</code>, <code>f64</code></td>
<td><code>Float</code>, <code>Double</code></td>
<td><code>Float</code>, <code>Double</code></td>
</tr>
</tbody>
</table>
<h3 id="optional-types">Optional Types</h3>
<p>Use <code>?</code> for optional values:</p>
<div class="codehilite"><pre><span></span><code>namespace template {
    string? get_optional_value();
}
</code></pre></div>

<p>Rust implementation:</p>
<div class="codehilite"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_optional_value</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="dictionary-struct">Dictionary (Struct)</h3>
<p>Define a struct with the <code>dictionary</code> keyword:</p>
<div class="codehilite"><pre><span></span><code>dictionary Person {
    string name;
    u32 age;
    string? email;  // Optional field
};

namespace template {
    Person create_person(string name, u32 age);
}
</code></pre></div>

<p>Rust implementation:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#[derive(Debug, Clone)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">name</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">age</span>: <span class="kt">u32</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">email</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">create_person</span><span class="p">(</span><span class="n">name</span>: <span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">age</span>: <span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">name</span><span class="p">,</span>
<span class="w">        </span><span class="n">age</span><span class="p">,</span>
<span class="w">        </span><span class="n">email</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="enum">Enum</h3>
<div class="codehilite"><pre><span></span><code><span class="k">enum</span><span class="w"> </span><span class="n">Status</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;Pending&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;Active&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;Completed&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">namespace</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Status</span><span class="w"> </span><span class="n">get_status</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>Rust:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#[derive(Debug, Clone, PartialEq)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">Status</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Pending</span><span class="p">,</span>
<span class="w">    </span><span class="n">Active</span><span class="p">,</span>
<span class="w">    </span><span class="n">Completed</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_status</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Status</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Status</span>::<span class="n">Active</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="error-handling">Error Handling</h2>
<h3 id="defining-errors">Defining Errors</h3>
<p>Errors are defined as interfaces with the <code>[Error]</code> attribute:</p>
<div class="codehilite"><pre><span></span><code><span class="k">[Error]</span>
<span class="na">interface MyError {</span>
<span class="w">    </span><span class="na">InvalidInput(string message);</span>
<span class="w">    </span><span class="na">NotFound(u64 id);</span>
<span class="w">    </span><span class="na">Timeout();</span>
<span class="na">};</span>
</code></pre></div>

<h3 id="using-errors-in-functions">Using Errors in Functions</h3>
<div class="codehilite"><pre><span></span><code>namespace template {
    [Throws=MyError]
    string process_data(string input);
}
</code></pre></div>

<h3 id="rust-implementation">Rust Implementation</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">#[derive(Debug, thiserror::Error, Clone, PartialEq)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">MyError</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cp">#[error(</span><span class="s">&quot;Invalid input: {message}&quot;</span><span class="cp">)]</span>
<span class="w">    </span><span class="n">InvalidInput</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">message</span>: <span class="nb">String</span> <span class="p">},</span>

<span class="w">    </span><span class="cp">#[error(</span><span class="s">&quot;Not found: {id}&quot;</span><span class="cp">)]</span>
<span class="w">    </span><span class="n">NotFound</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span>: <span class="kt">u64</span> <span class="p">},</span>

<span class="w">    </span><span class="cp">#[error(</span><span class="s">&quot;Operation timed out&quot;</span><span class="cp">)]</span>
<span class="w">    </span><span class="n">Timeout</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">input</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">MyError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">MyError</span>::<span class="n">InvalidInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">message</span>: <span class="s">&quot;Input cannot be empty&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">to_uppercase</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="swift-usage">Swift Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="k">do</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">result</span> <span class="p">=</span> <span class="k">try</span> <span class="n">processData</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="s">&quot;test&quot;</span><span class="p">)</span>
    <span class="bp">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kd">let</span> <span class="nv">error</span> <span class="k">as</span> <span class="n">MyError</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">.</span><span class="n">InvalidInput</span><span class="p">(</span><span class="kd">let</span> <span class="nv">message</span><span class="p">):</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Invalid: </span><span class="si">\(</span><span class="n">message</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">.</span><span class="n">NotFound</span><span class="p">(</span><span class="kd">let</span> <span class="nv">id</span><span class="p">):</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Not found: </span><span class="si">\(</span><span class="n">id</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">.</span><span class="n">Timeout</span><span class="p">:</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Timeout!&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="kotlin-usage">Kotlin Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processData</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">MyException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">is</span><span class="w"> </span><span class="n">MyException</span><span class="p">.</span><span class="na">InvalidInput</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Invalid: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">is</span><span class="w"> </span><span class="n">MyException</span><span class="p">.</span><span class="na">NotFound</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Not found: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">id</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">is</span><span class="w"> </span><span class="n">MyException</span><span class="p">.</span><span class="na">Timeout</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Timeout!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="async-functions">Async Functions</h2>
<p>Mark functions as async with the <code>[Async]</code> attribute:</p>
<div class="codehilite"><pre><span></span><code>namespace template {
    [Throws=MyError, Async]
    string fetch_data(string url);
}
</code></pre></div>

<h3 id="rust-implementation_1">Rust Implementation</h3>
<p>Requires <code>tokio</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fetch_data</span><span class="p">(</span><span class="n">url</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">MyError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Simulate async work</span>
<span class="w">    </span><span class="n">tokio</span>::<span class="n">time</span>::<span class="n">sleep</span><span class="p">(</span><span class="n">tokio</span>::<span class="n">time</span>::<span class="n">Duration</span>::<span class="n">from_millis</span><span class="p">(</span><span class="mi">100</span><span class="p">)).</span><span class="k">await</span><span class="p">;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;Data from {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="swift-usage_1">Swift Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="n">Task</span> <span class="p">{</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">data</span> <span class="p">=</span> <span class="k">try</span> <span class="k">await</span> <span class="n">fetchData</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="s">&quot;https://example.com&quot;</span><span class="p">)</span>
        <span class="bp">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Error: </span><span class="si">\(</span><span class="n">error</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="kotlin-usage_1">Kotlin Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="n">GlobalScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fetchData</span><span class="p">(</span><span class="s">&quot;https://example.com&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">MyException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Error: </span><span class="si">$</span><span class="n">e</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="objects-and-interfaces">Objects and Interfaces</h2>
<h3 id="interface-stateful-object">Interface (Stateful Object)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">constructor</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="n">initial_value</span><span class="p">);</span>

<span class="w">    </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">increment</span><span class="p">();</span>
<span class="w">    </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">decrement</span><span class="p">();</span>
<span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">value</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="rust-implementation_2">Rust Implementation</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">#[derive(Debug)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Counter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">value</span>: <span class="kt">u32</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">initial_value</span>: <span class="kt">u32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">value</span>: <span class="nc">initial_value</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">increment</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">decrement</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">value</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">value</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="swift-usage_2">Swift Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kd">let</span> <span class="nv">counter</span> <span class="p">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">initialValue</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">counter</span><span class="p">.</span><span class="n">increment</span><span class="p">()</span>
<span class="n">counter</span><span class="p">.</span><span class="n">increment</span><span class="p">()</span>
<span class="bp">print</span><span class="p">(</span><span class="n">counter</span><span class="p">.</span><span class="n">value</span><span class="p">())</span>  <span class="c1">// 12</span>
</code></pre></div>

<h3 id="kotlin-usage_2">Kotlin Usage</h3>
<div class="codehilite"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Counter</span><span class="p">(</span><span class="m">10</span><span class="n">u</span><span class="p">)</span>
<span class="n">counter</span><span class="p">.</span><span class="na">increment</span><span class="p">()</span>
<span class="n">counter</span><span class="p">.</span><span class="na">increment</span><span class="p">()</span>
<span class="n">println</span><span class="p">(</span><span class="n">counter</span><span class="p">.</span><span class="na">value</span><span class="p">())</span><span class="w">  </span><span class="c1">// 12</span>
</code></pre></div>

<hr />
<h2 id="complete-example">Complete Example</h2>
<p>Here's a complete example from this project (<code>src/template.udl</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="n">namespace</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Simple</span><span class="w"> </span><span class="n">functions</span>

<span class="w">    </span><span class="k">double</span><span class="w"> </span><span class="n">random</span><span class="p">();</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Function</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">rich</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">handling</span>
<span class="w">    </span><span class="o">[</span><span class="n">Throws=TemplateError</span><span class="o">]</span>
<span class="w">    </span><span class="n">EchoResult</span><span class="vm">?</span><span class="w"> </span><span class="n">echo</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="k">input</span><span class="p">);</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Async</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">cancellation</span>
<span class="w">    </span><span class="o">[</span><span class="n">Throws=TemplateError, Async</span><span class="o">]</span>
<span class="err">}</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="k">object</span>
<span class="n">interface</span><span class="w"> </span><span class="n">TemplateConfig</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">constructor</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="n">max_input_size</span><span class="p">,</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">enable_validation</span><span class="p">);</span>
<span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">max_input_size</span><span class="p">();</span>
<span class="w">    </span><span class="k">boolean</span><span class="w"> </span><span class="n">enable_validation</span><span class="p">();</span>
<span class="w">    </span><span class="o">[</span><span class="n">Throws=TemplateError</span><span class="o">]</span>
<span class="w">    </span><span class="n">EchoResult</span><span class="vm">?</span><span class="w"> </span><span class="n">validate_and_echo</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="k">input</span><span class="p">);</span>
<span class="err">}</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Cancellation</span><span class="w"> </span><span class="n">token</span>
<span class="n">interface</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">constructor</span><span class="p">();</span>
<span class="w">    </span><span class="n">void</span><span class="w"> </span><span class="n">cancel</span><span class="p">();</span>
<span class="w">    </span><span class="k">boolean</span><span class="w"> </span><span class="n">is_cancelled</span><span class="p">();</span>
<span class="err">}</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Rich</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">type</span>
<span class="k">dictionary</span><span class="w"> </span><span class="n">EchoResult</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="nc">text</span><span class="p">;</span>
<span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
<span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="nc">timestamp</span><span class="p">;</span>
<span class="w">    </span><span class="n">string</span><span class="vm">?</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span>
<span class="err">}</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">types</span>
<span class="o">[</span><span class="n">Error</span><span class="o">]</span>
<span class="n">interface</span><span class="w"> </span><span class="n">TemplateError</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">InputTooLarge</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="k">size</span><span class="p">,</span><span class="w"> </span><span class="n">u64</span><span class="w"> </span><span class="nf">max</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">hash</span><span class="p">);</span>
<span class="w">    </span><span class="n">InvalidInput</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="vm">?</span><span class="w"> </span><span class="n">input_preview</span><span class="p">);</span>
<span class="w">    </span><span class="n">OperationCancelled</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="k">operation</span><span class="p">);</span>
<span class="err">}</span><span class="p">;</span>
</code></pre></div>

<hr />
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-keep-udl-synced-with-rust">1. Keep UDL Synced with Rust</h3>
<p>Always ensure your UDL definitions match your Rust function signatures exactly.</p>
<h3 id="2-use-clear-names">2. Use Clear Names</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Good</span>
<span class="nb">string</span><span class="w"> </span><span class="n">get_user_name</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="n">user_id</span><span class="p">);</span>

<span class="c1">// Bad</span>
<span class="nb">string</span><span class="w"> </span><span class="n">gun</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="n">u</span><span class="p">);</span>
</code></pre></div>

<h3 id="3-document-complex-types">3. Document Complex Types</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// User profile information</span>
<span class="n">dictionary</span><span class="w"> </span><span class="n">UserProfile</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="nb">string</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="4-group-related-functions">4. Group Related Functions</h3>
<div class="codehilite"><pre><span></span><code>namespace template {
    // User management
    UserProfile create_user(string name);
    void delete_user(u64 id);

    // Data operations
    string process_data(string input);
    u64 get_data_size();
}
</code></pre></div>

<h3 id="5-use-meaningful-error-variants">5. Use Meaningful Error Variants</h3>
<div class="codehilite"><pre><span></span><code><span class="k">[Error]</span>
<span class="na">interface ApiError {</span>
<span class="w">    </span><span class="na">NetworkError(string message);</span>
<span class="w">    </span><span class="na">InvalidCredentials();</span>
<span class="w">    </span><span class="na">RateLimitExceeded(u32 retry_after_seconds);</span>
<span class="na">};</span>
</code></pre></div>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="build-error-parse-error">Build Error: "parse error"</h3>
<p><strong>Problem</strong>: UDL syntax error</p>
<p><strong>Solution</strong>: Check for:
- Missing semicolons
- Mismatched braces
- Invalid type names
- Run <code>cargo build</code> to see detailed error</p>
<h3 id="build-error-mismatched-types">Build Error: "mismatched types"</h3>
<p><strong>Problem</strong>: Rust implementation doesn't match UDL</p>
<p><strong>Solution</strong>:
- Ensure function signatures match exactly
- Check return types (UDL <code>string</code> = Rust <code>String</code>, not <code>&amp;str</code>)
- For interfaces, constructors should return <code>Self</code>, not <code>Arc&lt;Self&gt;</code></p>
<h3 id="functions-not-appearing-in-swiftkotlin">Functions Not Appearing in Swift/Kotlin</h3>
<p><strong>Problem</strong>: UDL not being processed</p>
<p><strong>Solution</strong>:
1. Check <code>build.rs</code> calls <code>uniffi::generate_scaffolding("src/template.udl")</code>
2. Check <code>src/lib.rs</code> has <code>uniffi::include_scaffolding!("template")</code>
3. Rebuild: <code>cargo clean &amp;&amp; cargo build</code></p>
<h3 id="type-conversion-errors">Type Conversion Errors</h3>
<p><strong>Problem</strong>: Wrong type in UDL</p>
<p><strong>Solution</strong>: Use this mapping:
- UDL <code>string</code> ‚Üí Rust <code>String</code> (not <code>&amp;str</code>)
- UDL <code>u32</code> ‚Üí Rust <code>u32</code> (exact match)
- UDL <code>boolean</code> ‚Üí Rust <code>bool</code></p>
<hr />
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="https://mozilla.github.io/uniffi-rs/">UniFFI Official Documentation</a></li>
<li><a href="https://mozilla.github.io/uniffi-rs/udl/">UniFFI UDL Reference</a></li>
<li><a href="https://github.com/mozilla/uniffi-rs/tree/main/examples">UniFFI Examples</a></li>
</ul>
<hr />
<h2 id="quick-reference-card">Quick Reference Card</h2>
<div class="codehilite"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">Basic</span><span class="w"> </span><span class="k">function</span>
<span class="n">ReturnType</span><span class="w"> </span><span class="n">function_name</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">param</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">Optional</span><span class="w"> </span><span class="k">return</span>
<span class="n">Type</span><span class="vm">?</span><span class="w"> </span><span class="n">optional_function</span><span class="p">();</span>

<span class="o">//</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">handling</span>
<span class="o">[</span><span class="n">Throws=ErrorType</span><span class="o">]</span>
<span class="n">Type</span><span class="w"> </span><span class="n">fallible_function</span><span class="p">();</span>

<span class="o">//</span><span class="w"> </span><span class="n">Async</span>
<span class="o">[</span><span class="n">Async</span><span class="o">]</span>
<span class="n">Type</span><span class="w"> </span><span class="n">async_function</span><span class="p">();</span>

<span class="o">//</span><span class="w"> </span><span class="n">Async</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">error</span>
<span class="o">[</span><span class="n">Throws=ErrorType, Async</span><span class="o">]</span>
<span class="n">Type</span><span class="w"> </span><span class="n">async_fallible</span><span class="p">();</span>

<span class="o">//</span><span class="w"> </span><span class="k">Dictionary</span><span class="w"> </span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>
<span class="k">dictionary</span><span class="w"> </span><span class="n">MyStruct</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">Type</span><span class="w"> </span><span class="n">field</span><span class="p">;</span>
<span class="w">    </span><span class="n">Type</span><span class="vm">?</span><span class="w"> </span><span class="n">optional_field</span><span class="p">;</span>
<span class="err">}</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Enum</span>
<span class="n">enum</span><span class="w"> </span><span class="n">MyEnum</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="ss">&quot;Variant1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;Variant2&quot;</span><span class="p">,</span>
<span class="err">}</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Interface</span><span class="w"> </span><span class="p">(</span><span class="k">object</span><span class="p">)</span>
<span class="n">interface</span><span class="w"> </span><span class="n">MyObject</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">constructor</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">param</span><span class="p">);</span>
<span class="w">    </span><span class="n">Type</span><span class="w"> </span><span class="k">method</span><span class="p">();</span>
<span class="err">}</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Error</span>
<span class="o">[</span><span class="n">Error</span><span class="o">]</span>
<span class="n">interface</span><span class="w"> </span><span class="n">MyError</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">ErrorVariant1</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="k">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">ErrorVariant2</span><span class="p">();</span>
<span class="err">}</span><span class="p">;</span>
</code></pre></div>

<hr />
<p><em>Last updated: 2025-01-11</em></p>
    </div>
</body>
</html>